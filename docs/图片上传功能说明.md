# 图片上传功能使用说明

## 功能概述

现在您的美团风格在线点餐系统已经支持真正的图片上传功能！您可以在编辑餐厅和菜品时上传本地图片文件，系统会自动处理并保存到服务器。

## 新增功能

### 1. 餐厅图片上传
- **餐厅Logo**: 支持上传餐厅标志图片，建议尺寸 200x200px
- **餐厅横幅**: 支持上传餐厅横幅图片，建议尺寸 800x300px

### 2. 菜品图片上传
- **菜品图片**: 支持上传菜品展示图片，建议尺寸 600x400px

### 3. 图片处理功能
- **自动压缩**: 上传的图片会自动压缩优化，减少存储空间
- **尺寸调整**: 自动调整图片尺寸，保持比例不变
- **格式转换**: 统一转换为JPEG格式，提高兼容性
- **唯一命名**: 使用UUID生成唯一文件名，避免冲突

## 支持的图片格式

- **JPG/JPEG**: 最常用的图片格式
- **PNG**: 支持透明背景
- **GIF**: 支持动画（会转换为静态图片）
- **WEBP**: 现代高效图片格式

## 文件大小限制

- **最大文件大小**: 5MB
- **建议文件大小**: 1-2MB，既保证质量又节省空间

## 使用方法

### 编辑餐厅图片

1. 进入管理员界面
2. 点击"餐厅管理"
3. 选择要编辑的餐厅，点击"编辑"
4. 在"图片信息"部分：
   - **上传Logo**: 点击"上传新Logo"，选择图片文件
   - **上传横幅**: 点击"上传新横幅"，选择图片文件
   - **或使用URL**: 也可以直接输入图片URL地址
5. 系统会显示图片预览
6. 点击"保存修改"完成上传

### 编辑菜品图片

1. 进入管理员界面
2. 点击"菜品管理"
3. 选择要编辑的菜品，点击"编辑"
4. 在"其他信息"部分：
   - **上传图片**: 点击"上传新图片"，选择图片文件
   - **或使用URL**: 也可以直接输入图片URL地址
5. 系统会显示图片预览
6. 点击"保存修改"完成上传

### 添加新菜品/餐厅

在添加新菜品或餐厅时，同样可以使用图片上传功能，操作方法相同。

## 图片存储位置

上传的图片会保存在以下目录：

```
static/
├── images/
│   ├── dishes/          # 菜品图片
│   ├── restaurants/     # 餐厅图片
│   ├── logos/          # 餐厅Logo
│   └── banners/        # 餐厅横幅
```

## 技术特性

### 安全性
- **文件类型检查**: 只允许上传图片文件
- **文件大小限制**: 防止上传过大文件
- **唯一文件名**: 使用UUID避免文件名冲突
- **路径安全**: 防止路径遍历攻击

### 性能优化
- **图片压缩**: 自动压缩减少存储空间
- **尺寸优化**: 调整到合适尺寸提高加载速度
- **格式统一**: 转换为JPEG格式提高兼容性

### 用户体验
- **实时预览**: 选择图片后立即显示预览
- **当前图片显示**: 编辑时显示当前使用的图片
- **双重选择**: 支持文件上传和URL输入两种方式
- **友好提示**: 清晰的格式和尺寸建议

## 安装依赖

如果您还没有安装图片处理库，请运行：

```bash
pip install Pillow==10.0.1
```

## 测试功能

运行测试脚本检查功能是否正常：

```bash
python test_image_upload.py
```

## 注意事项

1. **权限要求**: 只有管理员可以上传和编辑图片
2. **文件替换**: 上传新图片会自动删除旧图片文件
3. **备份建议**: 重要图片建议提前备份
4. **服务器空间**: 注意监控服务器存储空间使用情况

## 故障排除

### 上传失败
- 检查文件格式是否支持
- 确认文件大小是否超过5MB
- 验证网络连接是否正常

### 图片不显示
- 检查文件路径是否正确
- 确认static目录权限设置
- 验证图片文件是否存在

### 预览不工作
- 确认浏览器支持JavaScript
- 检查控制台是否有错误信息
- 尝试刷新页面重新操作

## 未来扩展

可以考虑的功能扩展：
- 批量图片上传
- 图片裁剪编辑
- 多尺寸图片生成
- 图片水印添加
- CDN集成支持

---

现在您可以为您的餐厅和菜品上传真实的图片了！这将大大提升用户体验和系统的专业性。 